pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
--init

function _init()
	plr = {
		sp=2,
		x=16,
		y=16,
		w=8,
		h=8,
		moving=false,
		d=0,
		acc=0.35,
		anim=0,
		move="down"
	}

	tiles = {}
		
 genlevel()
end

-->8
--update and draw--

--this just handles moves right now
function _update()
		plr_update()
end

--this draws the base map, player, and the generated wall tiles
function _draw()
		cls()
  map(0, 0, 0, 0, 16, 16)
  spr(plr.sp, plr.x, plr.y)
  
  for i in all(tiles) do
  	 mset(i.x, i.y, i.s)
  end
end
-->8
--collisions

function collide_map(obj,aim,flag)
	--obj = table x,y,w,h

	local x=obj.x local y=obj.y
	local w=obj.w local h=obj.h

	local x1=x local y1=y
	local x2=x+w-1 local y2=y+h-1

	--pixels to tiles

	x1/=8  x2/=8
	y1/=8  y2/=8


	if fget(mget(x1,y1),flag)
	or fget(mget(x1,y2),flag)
	or fget(mget(x2,y1),flag)
	or fget(mget(x2,y2),flag) then
		return true
	else
		return false
	end

end


-->8
--map functions--

--this randomly generates walls
function genlevel()
  for i=3, 12 do
    for j= 3, 12 do
      if flr(rnd(10)) == 0 and i!=1 and j!= 1 then
        temp = {}
        temp.x = i
        temp.y = j
        temp.s = 3
        add(tiles,temp)
      end
    end
  end
end
-->8
--player functions--

function plr_update()

	plr.moving = false
	plr.lastmove = plr.move
	plr.move = "idle"

	if btn(0) then
		plr.x-= 1
		plr.move = "left"
		plr.moving=true
		if collide_map(plr,"left",0) then
			plr.x +=1
			end
		end

	if btn(1) then
		plr.x += 1
		plr.move = "right"
		plr.moving=true
		if collide_map(plr,"right",0) then
			plr.x -= 1
			end
		end

	if btn(2) then
		plr.y -= 1
		plr.move = "up"
		plr.moving=true
		if collide_map(plr,"up",0) then
			plr.y += 1
			end
		end

	if btn(3) then
		plr.y += 1
		plr.move = "down"
		plr.moving=true
		if collide_map(plr,"down",0) then
			plr.y -= 1
			end
		end

end
__gfx__
00000000001111007777777755115111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000007000000755111551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700100000017070070711115551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000100000017007700715111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000100000017007700711551511000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700100000017070070711551155000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000007000000715111155000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001111007777777711151151000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33444333300000033000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3302033304244240044aa4400088088000880880000aaa000090000000a000a000a0000000000000000000000000000000000000000000000000000000000000
330303332444444204000040080080080888888800aa99a000a0090000a000000000000000000000000000000000000000000000000000000000000000000000
303730339aaaaaa940000004080000080888888800a9a9a000990a00aa0aa00000000a0000000000000000000000000000000000000000000000000000000000
087882032449944224499442008000800088888000a9aaa000aa090000a000000000a0a000000000000000000000000000000000000000000000000000000000
0888220324422442244224420008080000088800000aaa00099a999000a00a0000000a0000000000000000000000000000000000000000000000000000000000
30822033022222200222222000008000000080000000000099a99aa9000000000a00000000000000000000000000000000000000000000000000000000000000
33000333300000033000000300000000000000000000000000999990a00000000000000a00000000000000000000000000000000000000000000000000000000
00000900000900000009000000090000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111100000000
00a0900000000090009a9000000a9000000000000000000000000000000000000000000000000000000000000000000000000000111511111511111100000000
00090900000090000009a900009aa000000000000000000000000000000000000000000000000000000000000000000000000000155155151111111100000000
009aaa900099a900009aa900009aa900000000000000000000000000000000000000000000000000000000000000000000000000151111551111111100000000
009aa990009aa9900099a9000099a900000000000000000000000000000000000000000000000000000000000000000000000000111551551111111100000000
04444900044449000002400000024000000000000000000000000000000000000000000000000000000000000000000000000000151551115111111100000000
42202444422024440002400000024000000000000000000000000000000000000000000000000000000000000000000000000000551115515111111100000000
00000240000002400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000151151111111111100000000
33333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111511111111100000000
33900933000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000115515551111111100000000
30955903000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000155111551111111100000000
05999950000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111551111111111100000000
00400400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000151511551111111100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000155115511111111100000000
30000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111151511111111100000000
33333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000551551111111111100000000
33000033000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
30888803000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08222280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
82f82228000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
82882228000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
30000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06660000066606000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00006660006066600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06660000066600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000101000000000000000000000000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
3e3e3e3e3e3e000000003e3e3e3e3e3e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3e2d2d2d2d2d000000002d2d2d2d2d2e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3e3d0000000000000000000000003d2e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3e3d0000000000000000000000003d2e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3e3d0000000000000000000000003d2e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3e3d0000000000000000000000003d2e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3e3d0000000000000000000000003d2e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3e3d0000000000000000000000003d2e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3e3d0000000000000000000000003d2e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3e3d0000000000000000000000003d2e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3e2d2d2d2d2d000000002d2d2d2d2d3e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3e3e3e3e3e3e000000003e3e3e3e3e3e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
