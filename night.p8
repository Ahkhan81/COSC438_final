pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
--init

function _init()
	plr = {
		sp=96,
		x=8,
		y=24,
		w=8,
		h=8,
		moving=false,
		d=0,
		acc=0.35,
		anim=0,
		move="down",
  coins=100,
	}

	tiles = {}
		
 genlevel()
end

-->8
--update and draw--

--this just handles moves right now
function _update()
		plr_update()
end

--this draws the base map, player, and the generated wall tiles
function _draw()
		cls()
  map(0, 0, 0, 0, 16, 16)
  spr(plr.sp, plr.x, plr.y)
  
  for i in all(tiles) do
  	 mset(i.x, i.y, i.s)
  end
  
  rectfill(0,0,128,7,0)
  print("money: ", 128-40, 1, 7)
  print(plr.coins, 128-16, 1, 10)
  
end
-->8
--collisions

function collide_map(obj,aim,flag)
	--obj = table x,y,w,h

	local x=obj.x local y=obj.y
	local w=obj.w local h=obj.h

	local x1=x local y1=y
	local x2=x+w-1 local y2=y+h-1

	--pixels to tiles

	x1/=8  x2/=8
	y1/=8  y2/=8


	if fget(mget(x1,y1),flag)
	or fget(mget(x1,y2),flag)
	or fget(mget(x2,y1),flag)
	or fget(mget(x2,y2),flag) then
		return true
	else
		return false
	end

end


-->8
--map functions--

--this randomly generates walls
function genlevel()
  for i=3, 12 do
    for j= 3, 12 do
      if flr(rnd(15)) == 0 and i!=1 and j!= 1 then
        temp = {}
        temp.x = i
        temp.y = j
        temp.s = 12
        add(tiles,temp)
      elseif flr(rnd(150)) == 1 and i!=j and j!=1 then
        temp = {}
        temp.x = i
        temp.y = j
        temp.s = 17
        add(tiles, temp)
      end
    end
  end
end
-->8
--player functions--

function plr_update()

	plr.moving = false
	plr.lastmove = plr.move
	plr.move = "idle"

	if btn(0) then
		plr.x-= 1
		plr.move = "left"
		plr.moving=true
		if collide_map(plr,"left",0) then
			plr.x +=1
			end
		end

	if btn(1) then
		plr.x += 1
		plr.move = "right"
		plr.moving=true
		if collide_map(plr,"right",0) then
			plr.x -= 1
			end
		end

	if btn(2) then
		plr.y -= 1
		plr.move = "up"
		plr.moving=true
		if collide_map(plr,"up",0) then
			plr.y += 1
			end
		end

	if btn(3) then
		plr.y += 1
		plr.move = "down"
		plr.moving=true
		if collide_map(plr,"down",0) then
			plr.y -= 1
			end
		end

end
__gfx__
0000000000000000377777777777777733333333333333330000000000000000000000000000000000000000dd00155000000000011156dddd111550dddddddd
0000000000011000700000000000000000000000000000030000000000000000000000000000000000000000dd111d5055515551056155dddd551d50dddddddd
0070070001000010700000000000000088888888888888800000000000000000000000000000000000000000dd0016505d615d6105d111ddddd51750666d51dd
0007700001000010700000000000000022222222222222200000000000000000000000000000000000000000dd11111011111111055156dddd751110555516dd
0007700001000010700000000000000000000000000000030000000000000000000000000000000000000000dd00155015555155011156dddd751550111156dd
0070070001000010700000000000000033333333333333330000000000000000000000000000000000000000dd111d5015d6615605615ddddd111d50661156dd
0000000000011000700000000000000033333333333333330000000000000000000000000000000000000000dd551650dddddddd05d155dddd55175051615ddd
0000000000000000700000000000000033333333333333330000000000000000000000000000000000000000dd651110dddddddd055111dddd751110155155dd
3344433330000003300000030000000000000000000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddddddddddd
3302033304244240044aa4400088088000880880000aaa000090000000a000a000a000000000020000000000d550055dd500005ddddddddddddddddddddddddd
330303332444444204000040080080080888888800aa99a000a0090000a00000000000000088000000000000505005055000000565166d5165101010dd1666d5
303730339aaaaaa940000004080000080888888800a9a9a000990a00aa0aa00000000a000888882000000000505aa505500000055515555155101010dd515555
087882032449944224499442008000800088888000a9aaa000aa090000a000000000a0a0028822000000000050599505500000051111111111111111ddd51111
0888220324422442244224420008080000088800000aaa00099a999000a00a0000000a000022000000000000505005055000000516d516d516d516d5dd651165
30822033022222200222222000008000000080000000000099a99aa9000000000a000000000220200000000050111105501111051555155515551555dd651615
33000333300000033000000300000000000000000000000000999990a00000000000000a000000000000000001111111011111110000000000000000dd651651
000009000009000000090000000900000099900033330443000000000000000000000000000000001111100000000000011111111111111111111111dd551551
00a0900000000090009a9000000a90000090900033307303000000000000000000000000000000001100000000000000000001111115111115111111ddd51615
00090900000090000009a900009aa000009990003307d033000000000000000000000000000000001000000000000000000000111551551511111111dd651166
009aaa900099a900009aa900009aa900000a000030dd0033000000000000000000000000000000001000000000000000000000111511115511111111dd651111
009aa990009aa9900099a9000099a900000aa00030d01103000000000000000000000000000000001000000000000000000000111115515511111111dd615555
04444900044449000002400000024000000a000030100103000000000000000000000000000000000000000000000000000000011515511151111111dd15d666
42202444422024440002400000024000000aa00030111103000000000000000000000000000000000000000000000000000000015511155151111111dddddddd
000002400000024000000000000000000000000033000033000000000000000000000000000000000000000000000000000000011511511111111111dddddddd
33333333333333333d033dd03d033dd03333333333333333000000000000000000000000000000000000000000000000000000001111115111111111156156dd
33900933330000333d800d033d800d033300000030111133000000000000000000000000000000000000000000000000000000001155155511111111516156dd
30955903305555030888dd030888dd033099499401515113000000000000000000000000000000001000000000000000000000001551115511111111561156dd
0599995005000050088d8203088d8203330940940111151300000000000000000000000000000000000000000000000000000001111551111111111111115ddd
004004000000000002828203308282033309409401551513000000000000000000000000000000001000000000000000000000011515115511111111555515dd
000000000000000002822803308220333a99aaa4015115130000000000000000000000000000000010000000000000000000000115511551111111115d6661dd
30000003300000033022203330220333a94aa44430155113000000000000000000000000000000001100000000000000000000111111515111111111dddddddd
333333333333333330220333330033330000000033011133000000000000000000000000000000001111110000000000000011115515511111111111dddddddd
33000033333003333333333333333333333333333333033333333333333333333300003333000033333333333333333333088833333333333088033333300333
30888803330880333333333333333333333776633033333333333033333333333000000330000003330003333300033330886823333333330888803333088033
08222280308228030b33333b0b3333333370766d3330003303000330330003333700700330700703306870333087703330860783333333330868803333088833
82f8222830872803bbb333b3bbb33bb3337006dd33070703307070333070703330000003300000030d8086030808760308070080300888333378823330888803
82882228382222830b3bbb330b3bb33b376666dd33000003300000333000003330000003300000030d80860308087d0308000078088888233738820330288823
0888888038288283333333333333333336d6ddd000000000000000033000003330000003300000030d808d030808dd0328800002888882228688222232288222
3000000330800803333333333333333336d60003300003333300003333000333300000033000000330d8d033308dd03330288800302222000882220030022200
33333333333333333333333333333333300033333333333333333333333333333003003330030033330003333300033333000033330000333000003333302033
00000000006000008888888890000000000009000000000000008000008000803333344444433333000000000000000033333330066003333333333330000333
00000000006000000828820009998000099800000000000008088800000880003334499999944333000000000000000033333306655503333333333301111033
0666000006660600080820209aa998809aa98000000980000080980000899800334999a4aa999433000000000000000033333065555003333333333311111033
000000000000060002082000a77a9998a77a98800a798800008aa9800080a9093499aaa4aaaa9903000000000000000033333655500040333333333310111103
0000666000606660000220009aa998809aa9800000980000009a0999089a7090499a4aaaaaa4a990000000000000000033333650033040333333333110011110
000000000060000002000000099980000998000000000000008a7a99099a7a9049aaaaaaaaaaaa90000000000000000033333603333340333333333170711110
0666000006660000000200000000008090000000000000000009a9900009a900494a0aaaaa0aa490000000000000000033333033333302033333333100011110
00000000000000000000000000900000000000a000000000000000000000000049aaa0a90000aa90000000000000000033333333333330033333333101111110
000000000000000000000000000000000000000000000040000000000000000049aaaaa0aa0aaa90000000000000000033333333333330203333333111111103
4099990000000000099990000999904000000000099990400000000000000000494aaaa0aaaaa490000000000000000033333333333333003333333111111103
4999ff9004999900999ff900999999400999904099999940000000000000000049aaaaa0aaaaaa90000000000000000033333333333333003333333011111113
4f0ff0f00499ff90f0ff0f009999994099999940999999f00000000000000000499aaa000aaaa990000000000000000033333333333333333333333011111113
40ffff00040ff0f00ffff000099990409999994009999d40000000000000000034994aa0aaa49903000000000000000033333333333333333333333311103113
fddddd0004ffff004f4444440dddddf009999040fdddd0000000000000000000334999aa4a999033000000000000000033333333333333333333333301103333
40ddddf00fdddd000ddddf00fdddd0400dddddf00dddd00000000000000000003334499999900333000000000000000033333333333333333333333333103313
0030030004ddddf00300300003003000fdddd0400300300000000000000000003333300000003333000000000000000033333333333333333333333313033333
0000000000000000000f000033330003330999000099903333333333000000000000000000000000000000000000000000000000000000000000000000000000
000600000000042000f7e0003330665330ff99999999ff0333333333000000000000000000000000000000000000000000000000000000000000000000000000
000600000000420000eee0003366555330ff79999999ff0333111333000000000000000000000000000000000000000000000000000000000000000000000000
0006000000042000000e000033655043330f70799079f03331111133000000000000000000000000000000000000000000000000000000000000000000000000
00060000004200000002000036503343330770077009909031111133000000000000000000000000000000000000000000000000000000000000000000000000
00999000042000000002000035033343330777777777999031000033000000000000000000000000000000000000000000000000000000000000000000000000
000c000000000000000200003033334330ff7777777ff90337333333000000000000000000000000000000000000000000000000000000000000000000000000
000c0000000000000000000033333343330000000000003333333333000000000000000000000000000000000000000000000000000000000000000000000000
33333033033333333333333333333333333333333333333333333333333333333300000000003333333300000000333300000000000000000000000000000000
333330030033333333333333333333333333333333333333333333333333333330dd010ddddd00333300dd01110d003300000000000000000000000000000000
33333003003033333333333333333333333333333300000000033333333333330dd01110dddddd0330dddd01110ddd0300000000000000000000000000000000
3333300300300333333333333333333333333333000000000000003333333333ddd01110ddddddd00ddddd01110dddd000000000000000000000000000000000
3033000000000333333333311301133333333330000000000000000333333333ddd01110ddddddd00ddddd01110dddd000000000000000000000000000000000
3001100000003333330113001000133333333330000000000000000033333333ddd01110ddddddd00dddddd010ddddd000000000000000000000000000000000
30000000001333333301000000000333333333300000000000000000333333330dd01110dddddd0330dddddd0ddddd0300000000000000000000000000000000
330000000133333330000000000003333333330000000000000000003333333330d0010ddddd00333300dddddddd003300000000000000000000000000000000
33300001111333333000000000000033333333000000000000000000033333330000000000000000000000000000000000000000000000000000000000000000
333331001113333330000000000000333333300000ddd0100dd00000033333330440000000000000000000000000044000000000000000000000000000000000
3333300001333333300000000dd0003033333000dddd01110dddd000003333330444444400000000000000004444444000000000000000000000000000000000
333300000133333330d00dd0030d0d033333000ddddd01110ddddd00003333330044222244444444444444442222240000000000000000000000000000000000
d0000000111333333ddd0d3d033333333333000ddddd01110ddddd00003333330042444422222222222222224444240000000000000000000000000000000000
3dd000d0dd1113333333d333333333333333000ddddd01110ddddd00003333330042444444444444444444444444240000000000000000000000000000000000
3333d33333ddd333333333333333333333300000dddd01110dddd000003333330042444444444444444444444444240000000000000000000000000000000000
333333333333333333333333333333333330000000dd00100dd00000001333330042444444444444444444444444240000000000000000000000000000000000
01111111000000000000000000000000330000000000000000000000001333330004244444444444444444444442400000000000000000000000000000000000
10000000000000000000000000000000331000000000000000000000001333330004244444444444444444444442400000000000000000000000000000000000
10000000000000000000000000000000331000000000000000000000001333330004244444444444444444444442400000000000000000000000000000000000
10000000000000000000000000000000331000000000000000000000001333330004244444444444444444444442400000000000000000000000000000000000
11000000000000000000000000000000331000000000000000000000001133330004244444444444444444444442400000000000000000000000000000000000
01000000000000000000000000000000331000000000000000000000001133330004244444444444444444444442400000000000000000000000000000000000
00100000000000000000000000000000331100000000000000000000001133330004244444444444444444444442400000000000000000000000000000000000
00110000000000000000000000000000311100000000000000000000001111330004244444444444444444444442400000000000000000000000000000000000
00000000000000000000000000000000311100000000000000000000001111130042444444444444444444444444240000000000000000000000000000000000
00000000000000000000000000000000311110000000000000000000001111130042444444444444444444444444240000000000000000000000000000000000
0000000000000000000000000000000033d1110000000011110000000111d1130042444444444444444444444444240000000000000000000000000000000000
000000000000000000000000000000003333110000000111110000000111dd330042444422222222222222224444240000000000000000000000000000000000
000000000000000000000000000000003333dd100000111111111100011dd3330044222244444444444444442222440000000000000000000000000000000000
00000000000000000000000000000000333333d1100111d111ddddd1133333330444444400000000000000004444444000000000000000000000000000000000
000000000000000000000000000000003333331111dddd3311333333333333330440000000000000000000000000044000000000000000000000000000000000
00000000000000000000000000000000333331111333333333333333333333330000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1f1d1e1e1d1d2d3d3d2d1d1e1e1d1d0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e2d2d2d2d2d2d3d3d2d2d2d2d2d2d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b2d2d2d3d3d3d3d3d2d2d3d3d3d2d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e2d2d2d3d3d3d3d3d2d3d3d3d3d2d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e2d2d2d2d2d2d2d2d2d2d2d2d2d2d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e2d3d3d3d3d3d3d2d2d2d2d2d2d2d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2d3d3d3d3d3d3d3d2d2d2d2d2d2d2d2d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2d3d3d3d3d2d2d2d2d2d2d3d3d3d2d2d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2d3d3d3d2d2d2d2d2d2d2d3d3d3d2d2d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e2d2d2d2d3d3d3d3d2d2d3d3d3d2d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e2d2d2d2d2d2d2d3d2d2d2d3d3d2d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e2d2d2d2d2d2d2d2d2d2d2d3d3d2d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b2d2d2d2d3d3d3d2d2d2d2d2d2d2d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b2d2d2d2d3d3d2d2d2d2d2d2d2d2d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2f0c0c0c0c0c3d3d3d3d0c0c0c0c0c3f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
